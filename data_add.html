<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>


  </head>
  <body>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-firestore.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyAUz7HVJ9Q8FULMOdF2SV__wvlZGijM7lg",
        authDomain: "dashboard-mc-22f56.firebaseapp.com",
        databaseURL: "https://dashboard-mc-22f56.firebaseio.com",
        projectId: "dashboard-mc-22f56",
        storageBucket: "dashboard-mc-22f56.appspot.com",
        messagingSenderId: "408470441361",
        appId: "1:408470441361:web:f122406538edad8db51e30",
        measurementId: "G-JHXYT2P52W"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();



      

var getLatestAPIBasetime = function() {
  var a = new Date();
  var b = a.getTime();
  b -= b%(1000*60*60); // 분단위 이하 내림
  var c = a.getHours();
  if (c%3 ==2) {
    b-=(1000*60*60*2)
  } else if (c%3 == 1) {
    b-=(1000*60*60*1)
  } //else if (c%3 == 2) {
    //b-=(1000*60*60*2);
  //};
  return new Date(b);
};

var getLatestLOGBasetime = function() {
  var a = new Date();
  var b = a.getTime();
  b -= b%(1000*60*60); // 분단위 이하 내림
  return new Date(b);
};

var getLatestData = function(collection, time) {
  var docRef = db.collection(collection).doc(time);

  docRef.get().then(function(doc) {
      if (doc.exists) {
          console.log("Document data:", doc.data());
          console.log(doc.data());
      } else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
      }
  }).catch(function(error) {
      console.log("Error getting document:", error);
  });
  
  // return doc.data();
}

//JavaScript Date Object -> '201007031500' (YYYYMMDDHHMM)
var dateObjToString = function(date) {
  return dateObjToString_Base_Date(date)+dateObjToString_Base_Time(date)
}

//JavaScript Date Object -> '20100703' (YYYYMMDD)
var dateObjToString_Base_Date = function(date) {
  var base_date = (date.getYear()+1900)+'';
  if (date.getMonth() < 10 ) { base_date += '0'; }
  base_date += (date.getMonth()+1);
  if ( date.getDate() < 10 ) { base_date += '0'; }
  base_date += date.getDate();
  
  return base_date
}
//JavaScript Date Object -> '1500' (HHMM)
var dateObjToString_Base_Time = function(date) {  
  var base_time = '';
  if (date.getHours() < 10) { base_time += '0'; }
  base_time += ( date.getHours()*100 );

  return base_time
}
    </script>


  <!-- data input into cloud firestore -->
  <button id="add-btn"> ADD </button> 
  <button id="stp-btn"> STP </button> 
  <div></div><br>
  <script>
    var db = firebase.firestore();

    //'201007031500' (YYYYMMDDHHMM) -> JavaScript Date Object 
    var stringToDateObj = function(string) {
      return new Date(string.substr(0,4), string.substr(4,2)-1, string.substr(6,2), string.substr(8,2), string.substr(10,2));
    };

    //JavaScript Date Object -> '201007031500' (YYYYMMDDHHMM)
    var dateObjToString = function(date) {
      return dateObjToString_Base_Date(date)+dateObjToString_Base_Time(date)
    }

    //JavaScript Date Object -> '20100703' (YYYYMMDD)
    var dateObjToString_Base_Date = function(date) {
      var base_date = (date.getYear()+1900)+'';
      if (date.getMonth() < 10 ) { base_date += '0'; }
      base_date += (date.getMonth()+1);
      if ( date.getDate() < 10 ) { base_date += '0'; }
      base_date += date.getDate();
      
      return base_date
    }
    //JavaScript Date Object -> '1500' (HHMM)
    var dateObjToString_Base_Time = function(date) {  
      var base_time = '';
      if (date.getHours() == 0) {
        base_time += '0000'; 
      } else if (date.getHours() < 10) { 
        base_time += '0'; 
        base_time += ( date.getHours()*100 );
      } else {
        base_time += ( date.getHours()*100 );
      }
      return base_time
    }


    var addData = function(collection, time) {
      var keyTime = dateObjToString(time);
      var json = new Array();

      if(time.getHours()%3 ==0) {
      json = {
        inside_hum: Math.round(Math.random()*50)+20,
        outside_hum: Math.round(Math.random()*50)+20,
        inside_temp: Math.round(Math.random()*30)+0,
        outside_temp: Math.round(Math.random()*30)+0,
        time: time,
      } 
      } else {
      json = {
        inside_hum: Math.round(Math.random()*50)+20,
        inside_temp: Math.round(Math.random()*30)+0,
        time: time,
      } 
              
      }
      db.collection(collection).doc( keyTime ).set(json)
      .then(function() {
          console.log("Document written with ID: ", collection, " ",keyTime);
      })
      .catch(function(error) {
          console.error("Error adding document: ", error);
      });
    };

    var interval;
    var addDataLoop = function(){
      var nowTime = stringToDateObj("202001310000").getTime();
      // var nowTime = new Date().getTime();
      var startTime = "202001200000" //YYYY MM DD HH MM
      var timeInside = stringToDateObj(startTime).getTime();
      var timeOutside = stringToDateObj(startTime).getTime();
      
      interval = setInterval(function(){
        if(timeInside < nowTime) {
          addData("mc", new Date(timeInside))
          timeInside += 1000*60*60*1; // 1시간 단위로
        }
      },100)
      

      
    }

    $('#add-btn').click(function(){
      console.log("add_clicked")
      addDataLoop();
    })
    $('#stp-btn').click(function(){
      console.log("stp_clicked")
      clearInterval(insideInterval);
      clearInterval(outsideInterval);
    })
  </script>




  </body>
</html>
